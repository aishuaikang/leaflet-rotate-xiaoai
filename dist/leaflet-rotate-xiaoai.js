!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";L.Draggable.include({}),L.extend(L.Point.prototype,{rotate:function(t){return this.rotateFrom(t,new L.Point(0,0))},rotateFrom:function(t,e){if(!t)return this;var o=Math.sin(t),i=Math.cos(t),n=e.x,a=e.y,s=this.x-n,r=this.y-a;return new L.Point(s*i-r*o+n,s*o+r*i+a)}});const t=L.extend({},L.DivOverlay.prototype);L.DivOverlay.include({getEvents:function(){return L.extend(t.getEvents.apply(this,arguments),{rotate:this._updatePosition})},_updatePosition:function(){if(this._map&&(t._updatePosition.apply(this,arguments),this._map&&this._map._rotate&&this._zoomAnimated)){var e=this._getAnchor(),o=L.DomUtil.getPosition(this._container).subtract(e);L.DomUtil.setPosition(this._container,this._map.rotatedPointToMapPanePoint(o).add(e))}}});const e=L.extend({},L.Popup.prototype);L.Popup.include({_animateZoom:function(t){if(e._animateZoom.apply(this,arguments),this._map&&this._map._rotate){var o=this._getAnchor(),i=L.DomUtil.getPosition(this._container).subtract(o);L.DomUtil.setPosition(this._container,this._map.rotatedPointToMapPanePoint(i).add(o))}},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress))if(this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(L.DomUtil.getStyle(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+e,i=this._containerWidth,n=new L.Point(this._containerLeft,-o-this._containerBottom);n._add(L.DomUtil.getPosition(this._container));var a=n._add(this._map._getMapPanePos()),s=L.point(this.options.autoPanPadding),r=L.point(this.options.autoPanPaddingTopLeft||s),h=L.point(this.options.autoPanPaddingBottomRight||s),l=t.getSize(),p=0,d=0;a.x+i+h.x>l.x&&(p=a.x+i-l.x+h.x),a.x-p-r.x<0&&(p=a.x-r.x),a.y+o+h.y>l.y&&(d=a.y+o-l.y+h.y),a.y-d-r.y<0&&(d=a.y-r.y),(p||d)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([p,d]))}}});const o=L.extend({},L.Tooltip.prototype);L.Tooltip.include({_animateZoom:function(t){if(!this._map._rotate)return o._animateZoom.apply(this,arguments);var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);e=this._map.rotatedPointToMapPanePoint(e),this._setPosition(e)},_updatePosition:function(){if(!this._map._rotate)return o._updatePosition.apply(this,arguments);var t=this._map.latLngToLayerPoint(this._latlng);t=this._map.rotatedPointToMapPanePoint(t),this._setPosition(t)}});const i=L.extend({},L.GridLayer.prototype);L.GridLayer.include({getEvents:function(){var t=i.getEvents.apply(this,arguments);return this._map._rotate&&!this.options.updateWhenIdle&&(this._onRotate||(this._onRotate=L.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.rotate=this._onRotate),t},_getTiledPixelBounds:function(t){return this._map._rotate?this._map._getNewPixelBounds(t,this._tileZoom):i._getTiledPixelBounds.apply(this,arguments)}});const n=L.extend({},L.Map.prototype);L.Map.mergeOptions({rotate:!1,bearing:0}),L.Map.include({initialize:function(t,e){e.rotate&&(this._rotate=!0,this._bearing=0),n.initialize.apply(this,arguments),this.options.rotate&&this.setBearing(this.options.bearing)},containerPointToLayerPoint:function(t){return this._rotate?L.point(t).subtract(this._getMapPanePos()).rotateFrom(-this._bearing,this._getRotatePanePos()).subtract(this._getRotatePanePos()):n.containerPointToLayerPoint.apply(this,arguments)},layerPointToContainerPoint:function(t){return this._rotate?L.point(t).add(this._getRotatePanePos()).rotateFrom(this._bearing,this._getRotatePanePos()).add(this._getMapPanePos()):n.layerPointToContainerPoint.apply(this,arguments)},rotatedPointToMapPanePoint:function(t){return L.point(t).rotate(this._bearing)._add(this._getRotatePanePos())},mapPanePointToRotatedPoint:function(t){return L.point(t)._subtract(this._getRotatePanePos()).rotate(-this._bearing)},mapBoundsToContainerBounds:function(t){if(!this._rotate&&n.mapBoundsToContainerBounds)return n.mapBoundsToContainerBounds.apply(this,arguments);const e=this.getPixelOrigin(),o=this.layerPointToContainerPoint(this.project(t.getNorthWest())._subtract(e)),i=this.layerPointToContainerPoint(this.project(t.getNorthEast())._subtract(e)),a=this.layerPointToContainerPoint(this.project(t.getSouthWest())._subtract(e)),s=this.layerPointToContainerPoint(this.project(t.getSouthEast())._subtract(e));return L.bounds([L.point(Math.min(o.x,i.x,s.x,a.x),Math.min(o.y,i.y,s.y,a.y)),L.point(Math.max(o.x,i.x,s.x,a.x),Math.max(o.y,i.y,s.y,a.y))])},getBounds:function(){if(!this._rotate)return n.getBounds.apply(this,arguments);var t=this.getSize();return new L.LatLngBounds([this.containerPointToLatLng([0,0]),this.containerPointToLatLng([t.x,0]),this.containerPointToLatLng([t.x,t.y]),this.containerPointToLatLng([0,t.y])])},setBearing:function(t){if(L.Browser.any3d&&this._rotate){var e=L.Util.wrapNum(t,[0,360])*L.DomUtil.DEG_TO_RAD,o=this._getPixelCenter(),i=this._getRotatePanePos().rotateFrom(-this._bearing,o),n=i.rotateFrom(e,o);L.DomUtil.setPosition(this._rotatePane,i,e,o),this._pivot=o,this._bearing=e,this._rotatePanePos=n,this.fire("rotate")}},getBearing:function(){return this._bearing*L.DomUtil.RAD_TO_DEG},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),L.DomUtil.setPosition(this._mapPane,new L.Point(0,0)),this._rotate?(this._rotatePane=this.createPane("rotatePane",this._mapPane),this._norotatePane=this.createPane("norotatePane",this._mapPane),this.createPane("tilePane",this._rotatePane),this.createPane("overlayPane",this._rotatePane),this.createPane("shadowPane",this._norotatePane),this.createPane("markerPane",this._norotatePane),this.createPane("tooltipPane",this._norotatePane),this.createPane("popupPane",this._norotatePane)):(this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane")),this.options.markerZoomAnimation||(L.DomUtil.addClass(t.markerPane,"leaflet-zoom-hide"),L.DomUtil.addClass(t.shadowPane,"leaflet-zoom-hide"))},panInside(t,e){if(!this._rotate||Math.abs(this._bearing).toFixed(1)<.1)return n.panInside.apply(this,arguments);e=e||{};const o=L.point(e.paddingTopLeft||e.padding||[0,0]),i=L.point(e.paddingBottomRight||e.padding||[0,0]),a=this._container.getBoundingClientRect(),s=this.latLngToContainerPoint(t),r=L.bounds([L.point(a),L.point(a).add(this.getSize())]),h=r.getCenter(),l=L.bounds([r.min.add(o),r.max.subtract(i)]),p=l.getSize();if(!l.contains(s)){this._enforcingBounds=!0;const t=s.subtract(l.getCenter()),o=l.extend(s).getSize().subtract(p);h.x+=t.x<0?-o.x:o.x,h.y+=t.y<0?-o.y:o.y,this.panTo(this.containerPointToLatLng(h),e),this._enforcingBounds=!1}return this},getBoundsZoom(t,e,o){if(!this._rotate||Math.abs(this._bearing).toFixed(1)<.1)return n.getBoundsZoom.apply(this,arguments);t=L.latLngBounds(t),o=L.point(o||[0,0]);let i=this.getZoom()||0;const a=this.getMinZoom(),s=this.getMaxZoom(),r=this.getSize().subtract(o),h=this.mapBoundsToContainerBounds(t).getSize(),l=this.options.zoomSnap,p=r.x/h.x,d=r.y/h.y,_=e?Math.max(p,d):Math.min(p,d);return i=this.getScaleZoom(_,i),l&&(i=Math.round(i/(l/100))*(l/100),i=e?Math.ceil(i/l)*l:Math.floor(i/l)*l),Math.max(a,Math.min(s,i))},_getCenterOffset:function(t){var e=n._getCenterOffset.apply(this,arguments);return this._rotate&&(e=e.rotate(this._bearing)),e},_getRotatePanePos:function(){return this._rotatePanePos||new L.Point(0,0)},_getNewPixelOrigin:function(t,e){if(!this._rotate)return n._getNewPixelOrigin.apply(this,arguments);var o=this.getSize()._divideBy(2);return this.project(t,e).rotate(this._bearing)._subtract(o)._add(this._getMapPanePos())._add(this._getRotatePanePos()).rotate(-this._bearing)._round()},_getNewPixelBounds:function(t,e){if(t=t||this.getCenter(),e=e||this.getZoom(),!this._rotate&&n._getNewPixelBounds)return n._getNewPixelBounds.apply(this,arguments);var o=this._animatingZoom?Math.max(this._animateToZoom,this.getZoom()):this.getZoom(),i=this.getZoomScale(o,e),a=this.project(t,e).floor(),s=this.getSize(),r=new L.Bounds([this.containerPointToLayerPoint([0,0]).floor(),this.containerPointToLayerPoint([s.x,0]).floor(),this.containerPointToLayerPoint([0,s.y]).floor(),this.containerPointToLayerPoint([s.x,s.y]).floor()]).getSize().divideBy(2*i);return new L.Bounds(a.subtract(r),a.add(r))},_getPixelCenter:function(){return!this._rotate&&n._getPixelCenter?n._getPixelCenter.apply(this,arguments):this.getSize()._divideBy(2)._subtract(this._getMapPanePos())},_getPaddedPixelBounds:function(t){if(!this._rotate&&n._getPaddedPixelBounds)return n._getPaddedPixelBounds.apply(this,arguments);var e=t,o=this.getSize(),i=o.multiplyBy(-e),a=o.multiplyBy(1+e);return new L.Bounds([this.containerPointToLayerPoint([i.x,i.y]).floor(),this.containerPointToLayerPoint([i.x,a.y]).floor(),this.containerPointToLayerPoint([a.x,i.y]).floor(),this.containerPointToLayerPoint([a.x,a.y]).floor()])},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=t.coords.latitude,o=t.coords.longitude,i=t.coords.heading,n=new L.LatLng(e,o),a=n.toBounds(t.coords.accuracy),s=this._locateOptions;if(s.setView){var r=this.getBoundsZoom(a);this.setView(n,s.maxZoom?Math.min(r,s.maxZoom):r)}var h={latlng:n,bounds:a,timestamp:t.timestamp,heading:i};for(var l in t.coords)"number"==typeof t.coords[l]&&(h[l]=t.coords[l]);this.fire("locationfound",h)}}}),L.Map.mergeOptions({trackContainerMutation:!1}),L.Map.ContainerMutation=L.Handler.extend({addHooks:function(){this._observer||(this._observer=new MutationObserver(L.Util.bind(this._map.invalidateSize,this._map))),this._observer.observe(this._map.getContainer(),{childList:!1,attributes:!0,characterData:!1,subtree:!1,attributeFilter:["style"]})},removeHooks:function(){this._observer.disconnect()}}),L.Map.addInitHook("addHandler","trackContainerMutation",L.Map.ContainerMutation),L.Control.Rotate=L.Control.extend({options:{position:"topleft",closeOnZeroBearing:!0},onAdd:function(t){var e=this._container=L.DomUtil.create("div","leaflet-control-rotate leaflet-bar"),o=this._arrow=L.DomUtil.create("span","leaflet-control-rotate-arrow");o.style.backgroundImage="url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")",o.style.cursor="grab",o.style.display="block",o.style.width="100%",o.style.height="100%",o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition="50%";var i=this._link=L.DomUtil.create("a","leaflet-control-rotate-toggle",e);return i.appendChild(o),i.href="#",i.title="Rotate map",L.DomEvent.on(i,"dblclick",L.DomEvent.stopPropagation).on(i,"mousedown",this._handleMouseDown,this).on(i,"click",L.DomEvent.stop).on(i,"click",this._cycleState,this).on(i,"click",this._refocusOnMap,this),L.Browser.any3d||L.DomUtil.addClass(i,"leaflet-disabled"),this._restyle(),t.on("rotate",this._restyle,this),this._follow=!1,this._canFollow=!1,this.options.closeOnZeroBearing&&0===t.getBearing()&&(e.style.display="none"),e},onRemove:function(t){t.off("rotate",this._restyle,this)},_handleMouseDown:function(t){L.DomEvent.stop(t),this.dragging=!0,this.dragstartX=t.pageX,this.dragstartY=t.pageY,L.DomEvent.on(document,"mousemove",this._handleMouseDrag,this).on(document,"mouseup",this._handleMouseUp,this)},_handleMouseUp:function(t){L.DomEvent.stop(t),this.dragging=!1,L.DomEvent.off(document,"mousemove",this._handleMouseDrag,this).off(document,"mouseup",this._handleMouseUp,this)},_handleMouseDrag:function(t){if(this.dragging){var e=t.clientX-this.dragstartX;this._map.setBearing(e)}},_cycleState:function(t){this._map&&(this._map.setBearing(0),this._restyle())},_restyle:function(){if(this._map.options.rotate){var t=this._map.getBearing();this._arrow.style.transform="rotate("+t+"deg)",this._link.style.backgroundColor=null,t&&this.options.closeOnZeroBearing&&(this._container.style.display="block"),0===t&&this.options.closeOnZeroBearing&&(this._container.style.display="none")}else L.DomUtil.addClass(this._link,"leaflet-disabled")}}),L.control.rotate=function(t){return new L.Control.Rotate(t)},L.Map.mergeOptions({rotateControl:!0}),L.Map.addInitHook((function(){if(this.options.rotateControl){var t="object"==typeof this.options.rotateControl?this.options.rotateControl:{};this.rotateControl=L.control.rotate(t),this.addControl(this.rotateControl)}}))}));
//# sourceMappingURL=leaflet-rotate-xiaoai.js.map
